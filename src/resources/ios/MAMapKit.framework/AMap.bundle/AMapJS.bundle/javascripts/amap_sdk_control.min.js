"use strict";amap_sdk_log("SDK JS开始执行");var overlaysMap=new Map,satelliteLayer=void 0,trafficLayer=void 0,map=void 0;function initMap(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;amap_sdk_log("new AMap开始执行");var a={zoom:10,zooms:[3,20],center:[116.407525,39.90403],viewMode:"3D",drawMode:"fast",layers:[new AMap.VectorLayer]};null!=e&&"style_lazada"==(a.vectorMapForeign=e)&&(a.overseaDataType="mapbox"),null!=language&&(a.lang=language),amap_sdk_log("初始化地图 vectorMapForeign: "+e+" amap_sdk_is_load_worker_js: "+window.amap_sdk_is_load_worker_js+" language: "+language),map=new AMap.Map("container",a),amap_sdk_log("new AMap执行结束")}function createMap(){window.document.getElementById("container").className="show-map",window.testTime={start:(new Date).getTime(),renderTime:null,renderEnd:null,calc:function(e){return e-window.testTime.start}},window.startTime=(new Date).getTime(),amap_sdk_log("createMap"),map.resize(),AMap.Browser&&AMap.Browser.checkWebGL&&(AMap.Browser.isWebGL=AMap.Browser.checkWebGL()),map.add(new AMap.NebulaLayer),initListener(),callBackNative("onMapLoadComplete")}function destroyMap(){map&&map.destroy()}function onScriptLoad(){amap_sdk_log("SDK JS执行完成")}window.amap_sdk_is_load_worker_js&&window._PreLoadedWorker?amap_sdk_log("html中提前初始化worker"):(amap_sdk_log("js代码里提前初始化worker"),window._PreLoadedWorker=new Worker((new AMap.getConfig).workerUrl)),window._PreLoadedWorker.postMessage({targetMapId:0,sourceMapId:0,type:"initCryptWorker",id:String(1),data:!0}),window._PreLoadedWorker.onmessage=function(e){e.data&&"1"===e.data.id&&(amap_sdk_log("initWorker"),callBackNative("initWorker"),initMap(foreignStyle))};var changestate=0;function changeStart(){changestate++}function changeEnd(){--changestate<=0&&(changestate=0,callBackNative("onMapChangeFinish",map.getCenter().lat,map.getCenter().lng,map.getZoom(),map.getRotation(),map.getPitch()))}function initListener(){map.on("viewchange",function(e){callBackNative("onMapChange",map.getCenter().lat,map.getCenter().lng,map.getZoom(),map.getRotation(),map.getPitch());var a=getBounds(),t=map.lngLatToContainer(a.getNorthEast()),a=map.lngLatToContainer(a.getSouthWest());callBackNative("onMapBoundsChange",t.x,t.y,a.x,a.y)}),map.on("zoomstart",function(e){changeStart()}),map.on("rotatestart",function(e){changeStart()}),map.on("pitchstart",function(e){changeStart()}),map.on("touchstart",function(e){changeStart()}),map.on("movestart",function(e){changeStart()}),map.on("zoomend",function(e){changeEnd()}),map.on("rotateend",function(e){changeEnd()}),map.on("pitchend",function(e){changeEnd()}),map.on("touchend",function(e){changeEnd()}),map.on("moveend",function(e){changeEnd()}),map.on("firstPaint",function(e){amap_sdk_log("JS complete回调"),testTime.completeTime=(new Date).getTime()-testTime.start;e="firstPaint\n"+testTime.calc(e["style2.0-request"])+"\n"+testTime.calc(e["style2.0-loaded"])+"\n"+testTime.calc(e["style2.0-decoded"])+"\n"+testTime.calc(e.workerTime["style-parse-begin"])+"\n"+testTime.calc(e.workerTime["style-parse-end"])+"\n"+testTime.calc(e.workerTime["data-request"])+"\n"+testTime.calc(e.workerTime["data-loaded"])+"\n"+testTime.calc(e.workerTime["data-decode-begin"])+"\n"+testTime.calc(e.workerTime["data-decode-end"])+"\n"+testTime.calc(e["_drawFillRoad-begin"])+"\n"+testTime.calc(e["_drawFillRoad-end"])+"\n"+testTime.calc(e["_drawOutsea-begin"])+"\n"+testTime.calc(e["_drawOutsea-end"])+"\n"+testTime.completeTime+"\n";amap_sdk_log(e),callBackNative("onMapRenderComplete")}),map.on("click",function(e){callBackNative("onMapClick",e.lnglat.getLat(),e.lnglat.getLng())})}function onMarkerClick(e){callBackNative("onMarkerClick",e.target.getExtData())}function onPolylineClick(e){callBackNative("onPolylineClick",e.target.getExtData())}function onMarkerDragstart(e){callBackNative("onMarkerDragstart",e.target.getExtData(),e.lnglat.getLat(),e.lnglat.getLng())}function onMarkerDragging(e){callBackNative("onMarkerDragging",e.target.getExtData(),e.lnglat.getLat(),e.lnglat.getLng())}function onMarkerDragend(e){callBackNative("onMarkerDragend",e.target.getExtData(),e.lnglat.getLat(),e.lnglat.getLng())}function updateMarker(e,a){var t=overlaysMap.get(e);t?(null!=a.position&&t.setPosition(a.position),null!=a.icon&&t.setIcon(a.icon),null!=a.draggable&&t.setDraggable(a.draggable),null!=a.clickable&&t.setClickable(a.clickable),null!=a.anchor&&t.setAnchor(a.anchor),null!=a.angle&&t.setAngle(-a.angle),null!=a.zIndex&&t.setzIndex(a.zIndex),null!=a.offset&&t.setOffset(a.offset),null!=a.visible&&(a.visible?t.show():t.hide())):amap_sdk_log("updateMarker not found marker "+e)}function addOverlay(e,a){var t;a&&((a=strToJson(a)).extData=e,a.icon&&null!=a.icon.image&&(t=a.icon,a.icon=new AMap.Icon(t)),t=0,"POLYLINE"==a.overlayType?((t=new AMap.Polyline(a)).on("click",onPolylineClick),handleOverlayVisible(a.visible,t)):"MARKER"==a.overlayType?(a.topWhenClick=!0,t=new AMap.Marker(a),null!=a.angle&&t.setAngle(-a.angle),t.on("click",onMarkerClick),t.on("dragstart",onMarkerDragstart),t.on("dragging",onMarkerDragging),t.on("dragend",onMarkerDragend)):"POLYGON"==a.overlayType&&(t=new AMap.Polygon(a),handleOverlayVisible(a.visible,t)),t&&(map.add(t),overlaysMap.set(e,t)))}function updateOverlay(e,a){var t;a&&((t=overlaysMap.get(e))||amap_sdk_log("updateOverlay not found overlay "+e),(a=strToJson(a)).icon&&null!=a.icon.image&&(iconJson=a.icon,a.icon=new AMap.Icon(iconJson)),"MARKER"==a.overlayType?updateMarker(e,a):(a.path&&t.setPath(a.path),t.setOptions(a),handleOverlayVisible(a.visible,t)))}function handleOverlayVisible(e,a){null!=e&&null!=a&&(e?a.show():a.hide())}function removeOverlay(e){var a;e&&((a=overlaysMap.get(e))?map.remove(a):amap_sdk_log("removeOverlay not found overlay "+e))}function addSattliteLayer(){null==satelliteLayer&&(satelliteLayer=new AMap.TileLayer.Satellite),map.add(satelliteLayer)}function removeSattliteLayer(){null!=satelliteLayer&&map.remove(satelliteLayer)}function moveCamera(e){var a=1<arguments.length&&void 0!==arguments[1]&&arguments[1];null!=e&&(map.setStatus({animateEnable:a}),null!=(e=strToJson(e)).position&&map.setCenter(e.position),null!=e.rotate&&map.setRotation(-e.rotate),null!=e.zoom&&map.setZoom(e.zoom),null!=e.tilt&&map.setPitch(e.tilt))}function setZooms(e,a){null!=a&&null!=e&&map.setZooms([e,a])}function updateMapOptions(e){e=strToJson(e);map.setStatus(e)}function setMapStyle(e,a){switch(e){case 0:map.setMapStyle("amap://styles/"+a);break;case 1:map.setMapStyle("amap://styles/normal");break;case 2:break;case 3:map.setMapStyle("amap://styles/dark")}(2==e?addSattliteLayer:removeSattliteLayer)()}function showTraffic(e){e?(null==trafficLayer&&(trafficLayer=new AMap.TileLayer.Traffic),map.add(trafficLayer)):trafficLayer&&map.remove(trafficLayer)}function getMapOptions(e){if(null!=e){e=map.getStatus()[e];return null!=e&&e}}function lngLatToScreen(e){return map.lngLatToContainer(new AMap.LngLat(e[0],e[1]))}function screenToLngLat(e){return map.containerToLngLat(new AMap.Pixel(e[0],e[1]))}function setLimitBounds(e,a){null!=e&&null!=a&&(a=new AMap.Bounds(e,a),map.setLimitBounds(a))}function setBounds(e,a){var t=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[0,0,0,0];null!=e&&null!=a&&(a=new AMap.Bounds(e,a),map.setStatus({animateEnable:t}),map.setBounds(a,!t,n))}function getBounds(){return map.getBounds()}function setFitView(){var e,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=3<arguments.length&&void 0!==arguments[3]&&arguments[3],l=[],i=map.getZooms()[1];for(e in a){var r=a[e],s=overlaysMap.get(r);s?l.push(s):amap_sdk_log("该overlay="+r+"不存在")}map.setStatus({animateEnable:o}),map.setFitView(l,t,n,i)}function showMapLabel(){showMapFeature("point",!(0<arguments.length&&void 0!==arguments[0])||arguments[0])}function showMapBuilding(){showMapFeature("building",!(0<arguments.length&&void 0!==arguments[0])||arguments[0])}function showMapFeature(){var e,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];null!=a&&(amap_sdk_log(map),(e=map.getFeatures())?(t?e.indexOf(a)<0&&e.push(a):-1<(a=e.indexOf(a))&&e.splice(a,1),map.setFeatures(e)):amap_sdk_log("error: features is undefine when showMapFeature!! "+e))}function strToJson(str){var json=eval("("+str+")");return json}